{namespace f=TYPO3\CMS\Fluid\ViewHelpers}

<nav class="c-menu js-menu" aria-label="Hauptnavigation" data-menu-root>
    <!-- Öffnen-Toggle (Burger) -->
    <button class="c-menu__toggle"
            type="button"
            aria-controls="primary-menu-wrapper"
            aria-expanded="false"
            data-menu-toggle>
        <span aria-hidden="true"></span>
        <span class="u-visually-hidden">Menü</span>
    </button>

    <!-- Overlay-Wrapper -->
    <div id="primary-menu-wrapper" class="c-menu__wrapper" data-menu-wrapper>

        <!-- Overlay-Header mit Titel + Schließen -->
        <div class="c-menu__head">
            <h2 class="c-menu__title">Menü</h2>
            <button class="c-menu__close"
                    type="button"
                    aria-controls="primary-menu-wrapper"
                    aria-expanded="true"
                    aria-label="Menü schließen"
                    data-menu-toggle>
                <span aria-hidden="true"></span>
                <span class="u-visually-hidden">Schließen</span>
            </button>
        </div>

        <!-- Optionaler Home-Link als erstes Element -->
        <f:variable name="homeUid" value="{homePageUid}" />
        <f:if condition="{homeUid}"><f:then /><f:else><f:variable name="homeUid" value="{site.rootPageId}" /></f:else></f:if>

        <ul class="c-menu__list" role="list">
            <li class="c-menu__item">
                <a href="{f:uri.page(pageUid: homeUid)}" class="c-menu__link">Startseite</a>
            </li>

            <f:for each="{menuMain}" as="item">
                <li class="c-menu__item
                           {f:if(condition:item.children, then:'has-submenu')}
                           {f:if(condition:item.active, then:' is-active')}
                           {f:if(condition:item.current, then:' is-active')}"
                    {f:if(condition:item.children, then:'data-has-submenu="true"')}>
                <f:if condition="{item.children}">
                    <f:then>
                        <!-- Parent-Link -->
                        <a href="{item.link}"
                           class="c-menu__link js-menu-parent
                                      {f:if(condition:item.active, then:' is-active')}{f:if(condition:item.current, then:' is-active')}"
                           aria-haspopup="true"
                           aria-expanded="false"
                           aria-controls="submenu-{item.uid}"
                           data-menu-parent>
                            {item.title}
                        </a>

                        <!-- Drill-Pfeil rechts -->
                        <button class="c-menu__drill"
                                type="button"
                                aria-label="Ebene öffnen"
                                data-menu-drill="submenu-{item.uid}">
                        </button>

                        <!-- Submenü -->
                        <div id="submenu-{item.uid}" class="c-menu__submenu" role="group" data-menu-submenu>
                            <f:for each="{item.children}" as="child">
                                <a href="{child.link}"
                                   class="c-menu__submenu-link {f:if(condition:child.active, then:' is-active')}">
                                    {child.title}
                                </a>
                            </f:for>
                        </div>
                    </f:then>
                    <f:else>
                        <a href="{item.link}"
                           class="c-menu__link {f:if(condition:item.active, then:' is-active')}{f:if(condition:item.current, then:' is-active')}">
                            {item.title}
                        </a>
                    </f:else>
                </f:if>
                </li>
            </f:for>
        </ul>

        <!-- CTA unterhalb der Hauptnavigation -->
        <f:variable name="ctaLabel" value="{ctaPublicLabel}" />
        <f:if condition="{ctaLabel}"><f:then /><f:else><f:variable name="ctaLabel" value="{settings.ctaPublic.label}" /></f:else></f:if>
        <f:if condition="{ctaLabel}"><f:then /><f:else><f:variable name="ctaLabel" value="Öffentliche Seminartermine" /></f:else></f:if>

        <f:variable name="ctaPid" value="{ctaPublicPageUid}" />
        <f:if condition="{ctaPid}"><f:then /><f:else><f:variable name="ctaPid" value="{settings.ctaPublic.pageUid}" /></f:else></f:if>
        <f:if condition="{ctaPid}"><f:then /><f:else><f:variable name="ctaPid" value="25" /></f:else></f:if>

        <a href="{f:uri.page(pageUid: ctaPid)}" class="c-menu__cta" title="{ctaLabel}">
            {ctaLabel}
        </a>
    </div>
</nav>
