// ======================================================
// components/_c-typography.scss
// Einheitliches Typografiesystem mit fluidem Scaling (fixe Units)
// ======================================================

@use '../base/b-variables' as v;
@use 'sass:math';
@use 'sass:meta';

// ------------------------------------------------------
// 0. Helper: beliebige Längen -> px normalisieren
// ------------------------------------------------------
@function to-px($value) {
  @if meta.type-of($value) != 'number' {
    @error 'to-px(): Expected a number, got #{meta.type-of($value)}.';
  }

  // Unitlos -> als px interpretieren
  @if math.is-unitless($value) {
    @return $value * 1px;
  }

  // Bereits px?
  @if math.compatible($value, 1px) {
    // durch 1px teilen: dimensionless, dann wieder px anhängen
    @return math.div($value, 1px) * 1px;
  }

  // rem -> px (Systemannahme: 1rem = 16px)
  @if math.compatible($value, 1rem) {
    @return math.div($value, 1rem) * 16px;
  }

  // em -> px (bewusst fix 16px Basis; keine kontextabhängigen em)
  @if math.compatible($value, 1em) {
    @return math.div($value, 1em) * 16px;
  }

  @error 'to-px(): Unsupported unit for #{$value}. Use px/rem/em or unitless.';
}

// ------------------------------------------------------
// 1. Fluid-Scale-Funktion (unit-safe Version)
// ------------------------------------------------------
//
// Erzeugt dynamische Fontgrößen auf Basis der Viewportbreite.
// Beispiel:
//   font-size: fluid-size(16px, 48px);
// Ergibt: clamp(1rem, <intercept>rem + <slope>vw, 3rem);

@function fluid-size($min, $max, $min-vw: 320px, $max-vw: 1440px) {
  // Eingaben nach px normalisieren
  $min-px: to-px($min);
  $max-px: to-px($max);
  $minvw-px: to-px($min-vw);
  $maxvw-px: to-px($max-vw);

  // Steigung als vw-Koeffizient (% pro vw)
  $slope-vw: math.div(($max-px - $min-px), ($maxvw-px - $minvw-px)) * 100;

  // Achsenabschnitt in px (bei min-vw)
  $intercept-px: $min-px - math.div($slope-vw, 100) * $minvw-px;

  // Ausgabe in rem/vw (Basis 16px)
  $min-rem: math.div($min-px, 16px);
  $max-rem: math.div($max-px, 16px);
  $intercept-rem: math.div($intercept-px, 16px);

  @return clamp(#{$min-rem}rem, #{$intercept-rem}rem + #{$slope-vw}vw, #{$max-rem}rem);
}

// ------------------------------------------------------
// 2. Grundtypografie
// ------------------------------------------------------

body {
  font-family: v.$font-body;
  font-size: v.$font-size-base;
  line-height: v.$line-height-base;
  color: v.$color-text;
  font-weight: v.$font-weight-regular;
  background-color: v.$color-bg-light;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

// ------------------------------------------------------
// 3. Headline-Mixin (für Wiederverwendung)
// ------------------------------------------------------

@mixin heading($level, $min-size, $max-size) {
  font-family: v.$font-heading;
  line-height: v.$line-height-heading;
  color: v.$color-secondary;
  margin-bottom: 0.5em;
  font-weight: v.$font-weight-semibold;
  font-size: fluid-size($min-size, $max-size);

  @if $level == 1 {
    font-weight: v.$font-weight-bold;
  }
}

// ------------------------------------------------------
// 4. Headings
// ------------------------------------------------------

h1 { @include heading(1, 36px, 64px); }
h2 { @include heading(2, 28px, 48px); }
h3 { @include heading(3, 22px, 32px); }
h4 { @include heading(4, 18px, 24px); }

h1, h2, h3, h4 {
  &:not(:first-child) {
    margin-top: 1.5em;
  }
}

// ------------------------------------------------------
// 5. Fließtext & Kleingedrucktes
// ------------------------------------------------------

p {
  font-size: fluid-size(15px, 16px);
  line-height: v.$line-height-base;
  margin-bottom: 1.25em;
  color: v.$color-text;
}

small,
.caption {
  font-size: fluid-size(12px, 14px);
  color: v.$color-text-light;
  line-height: 1.4;
}

// ------------------------------------------------------
// 6. Links & Interaktionen
// ------------------------------------------------------

a {
  color: v.$color-primary;
  text-decoration: none;
  transition: color 0.2s ease;

  &:hover,
  &:focus {
    color: v.$color-primary-light;
    text-decoration: underline;
  }

  &:active {
    opacity: 0.8;
  }
}

// ------------------------------------------------------
// 7. Utility-Klassen
// ------------------------------------------------------

.u-text-center  { text-align: center !important; }
.u-text-justify { text-align: justify !important; }
.u-text-upper   { text-transform: uppercase; letter-spacing: 0.05em; }

.u-text-light   { color: v.$color-text-light !important; }
.u-text-white   { color: #fff !important; }

.u-text-bold     { font-weight: v.$font-weight-bold !important; }
.u-text-semibold { font-weight: v.$font-weight-semibold !important; }

// ------------------------------------------------------
// 8. Responsive Feinschliff (Intro, Teaser etc.)
// ------------------------------------------------------

.c-intro-text {
  font-size: fluid-size(18px, 22px);
  line-height: 1.7;
  color: v.$color-text;
  max-width: 65ch;
  margin: 0 auto 2rem auto;
  text-align: center;
}

// ------------------------------------------------------
// Ende der Typografie
// ======================================================
